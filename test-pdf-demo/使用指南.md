# PDF 解析 Demo - 使用指南

## 🚀 快速开始

### 1. 启动项目

```bash
cd test-pdf-demo
npm install
npm run dev
```

打开浏览器访问：http://localhost:3000

---

## 📋 界面说明

### 左侧控制面板

```
┌─────────────────────────────┐
│ PDF 解析 Demo                │
├─────────────────────────────┤
│ ✓ API 凭证已配置            │
│   x-ti-app-id: 4ae172b2...  │
├─────────────────────────────┤
│ 选择 API 端点：              │
│ ○ 通用文档解析              │
│   支持 PDF、图片等多种格式   │
│                              │
│ ○ PDF 转 Excel              │
│   将表格转换为 Excel 格式    │
├─────────────────────────────┤
│ 上传 PDF 文件                │
│ [选择文件]                   │
│ 已选择: document.pdf         │
├─────────────────────────────┤
│ [调用 API 解析] 🔵          │
│ [使用模拟数据测试] 🟢       │
├─────────────────────────────┤
│ 📊 解析结果                  │
│ 总页数: 3                    │
│ 总元素数: 15                 │
├─────────────────────────────┤
│ 使用说明                     │
│ 1. 选择 API 端点            │
│ 2. 上传 PDF 文件            │
│ 3. 选择调用方式             │
│ ...                          │
└─────────────────────────────┘
```

### 右侧预览区

- PDF 渲染显示
- 彩色标识框叠加
- 缩放和翻页控制
- 元素类型图例

---

## 🎯 使用步骤

### 方式 A：调用真实 API

1. **选择 API 端点**
   - 单选按钮选择：通用文档解析 或 PDF转Excel
   - 根据你的需求选择合适的端点

2. **上传 PDF 文件**
   - 点击"选择文件"按钮
   - 选择要解析的 PDF 文档

3. **调用 API**
   - 点击 **"调用 API 解析"** 按钮（蓝色）
   - 等待解析完成（可能需要几秒到几十秒）
   - 查看浏览器控制台获取详细日志

4. **查看结果**
   - 右侧显示 PDF 预览
   - 彩色框标注不同类型的元素
   - 左侧显示统计信息

### 方式 B：使用模拟数据

1. **上传任意 PDF**
   - 选择任意 PDF 文件

2. **快速测试**
   - 点击 **"使用模拟数据测试"** 按钮（绿色）
   - 立即显示模拟的标识框
   - 无需等待 API 响应

---

## 🔍 API 端点说明

### 1. 通用文档解析

**URL:** `https://api.textin.com/robot/v1.0/api/parse`

**特点：**
- ✅ 支持多种文档格式（PDF、图片等）
- ✅ 识别文本、表格、图片、标题等元素
- ✅ 返回元素位置坐标
- ✅ 适合通用文档处理

**适用场景：**
- 一般文档解析
- 元素位置溯源
- 文档结构分析

### 2. PDF 转 Excel

**URL:** `https://api.textin.com/ai/service/v1/pdf_to_excel`

**特点：**
- ✅ 专门处理表格
- ✅ 高精度表格识别
- ✅ 保留表格结构
- ✅ 可导出 Excel

**适用场景：**
- 表格提取
- 财务报表处理
- 数据表格转换

---

## 🎨 标识框颜色

右侧 PDF 上会显示不同颜色的标识框：

| 颜色 | 类型 | 说明 |
|------|------|------|
| 🟥 红色 | text | 普通文本 |
| 🟩 绿色 | table | 表格区域 |
| 🟦 蓝色 | image | 图片区域 |
| 🟧 橙色 | title | 标题 |
| 🟪 紫色 | paragraph | 段落 |

每个标识框左上角有序号标签（①②③...）

---

## 🛠️ 控制操作

### 翻页

- **上一页** 按钮：`◄`
- **下一页** 按钮：`►`
- **页码显示**：当前页 / 总页数

### 缩放

- **放大** 按钮：`+`
- **缩小** 按钮：`-`
- **缩放范围**：50% - 300%
- **显示比例**：实时显示当前缩放值

---

## 🔧 调试技巧

### 查看 API 请求详情

打开浏览器开发者工具（F12）：

1. **Console 标签页**
   ```
   查看日志输出：
   - 调用 TextIn API: { url, fileName, fileType, fileSize }
   - API 响应状态: 200 OK
   - API 返回结果: { code, result, ... }
   - 解析结果: { pages, rects, ... }
   ```

2. **Network 标签页**
   ```
   查看网络请求：
   - 请求方法: POST
   - 请求 URL: https://api.textin.com/...
   - 请求 Headers: x-ti-app-id, x-ti-secret-code
   - 响应状态: 200 / 400 / 500
   - 响应内容: JSON 数据
   ```

### 常见错误码

| 错误码 | 说明 | 解决方法 |
|--------|------|----------|
| 401 | 认证失败 | 检查 app-id 和 secret-code |
| 403 | 权限不足 | 确认账号权限或配额 |
| 400 | 请求参数错误 | 检查文件格式和大小 |
| 500 | 服务器错误 | 稍后重试或联系技术支持 |

---

## 📊 返回数据格式

### API 响应结构

```json
{
  "code": 200,
  "message": "success",
  "result": {
    "pages": [
      {
        "page_id": 0,
        "width": 595,
        "height": 842,
        "angle": 0,
        "rects": [
          {
            "position": [x1, y1, x2, y2, x3, y3, x4, y4],
            "type": "text",
            "content_id": 1
          }
        ]
      }
    ]
  }
}
```

### 坐标说明

```
position 数组包含 8 个值，表示 4 个点：

(x1,y1) ──────── (x2,y2)
   │               │
   │   标识框      │
   │               │
(x4,y4) ──────── (x3,y3)

坐标系：
- 原点 (0,0) 在左上角
- X 轴向右增加
- Y 轴向下增加
```

---

## ⚠️ 注意事项

### 文件要求

1. **格式**：PDF 文件
2. **大小**：建议 < 10MB
3. **页数**：建议 < 50 页
4. **质量**：清晰可读的 PDF

### 性能提示

1. **大文件**：处理时间较长，请耐心等待
2. **多页文档**：只加载当前页，翻页时自动加载
3. **网络状况**：API 调用需要稳定的网络连接

### API 配额

- 使用的是共享测试凭证
- 可能有调用次数限制
- 如需大量使用，请申请独立凭证

---

## 🐛 故障排查

### PDF 无法加载

**可能原因：**
- PDF 文件损坏
- 文件过大
- 浏览器不支持

**解决方法：**
- 尝试其他 PDF 文件
- 检查文件大小
- 使用现代浏览器（Chrome/Firefox/Edge）

### API 调用失败

**可能原因：**
- 网络连接问题
- API 凭证过期
- 文件格式不支持
- API 服务暂时不可用

**解决方法：**
- 检查网络连接
- 查看控制台错误信息
- 使用"模拟数据测试"验证界面
- 尝试不同的 PDF 文件

### 标识框不显示

**可能原因：**
- API 未返回位置数据
- 数据格式不匹配
- 坐标超出范围

**解决方法：**
- 查看控制台日志
- 检查 API 返回数据
- 尝试"模拟数据测试"
- 切换不同的 API 端点

---

## 💡 使用建议

### 最佳实践

1. **首次使用**
   - 先用"模拟数据测试"熟悉界面
   - 再尝试真实 API 调用

2. **选择端点**
   - 通用文档 → 通用文档解析
   - 表格密集 → PDF 转 Excel

3. **测试文件**
   - 从简单文档开始
   - 逐步尝试复杂文档

4. **调试问题**
   - 始终打开浏览器控制台
   - 查看完整的请求和响应

---

## 📚 相关资源

### 项目文档

- [README.md](./README.md) - 项目完整说明
- [QUICKSTART.md](./QUICKSTART.md) - 快速开始指南
- [docs/TEXTIN_API_GUIDE.md](./docs/TEXTIN_API_GUIDE.md) - API 详细指南
- [docs/DEMO_FEATURES.md](./docs/DEMO_FEATURES.md) - 功能详细说明

### 官方资源

- [TextIn 官网](https://www.textin.com/)
- [TextIn API 文档](https://www.textin.com/document)
- [Next.js 文档](https://nextjs.org/docs)
- [React-PDF 文档](https://github.com/wojtekmaj/react-pdf)

---

## 🎓 学习建议

### 初学者

1. ✅ 阅读本使用指南
2. ✅ 使用"模拟数据测试"熟悉界面
3. ✅ 尝试上传简单的 PDF
4. ✅ 观察标识框效果

### 进阶用户

1. ✅ 查看浏览器控制台日志
2. ✅ 分析 API 返回数据结构
3. ✅ 对比不同 API 端点的效果
4. ✅ 阅读源代码理解实现

### 开发者

1. ✅ 阅读 `src/` 目录下的代码
2. ✅ 理解坐标转换逻辑
3. ✅ 学习 SVG 标识框绘制
4. ✅ 参考 xparse-frontend 实现

---

## 🎉 开始使用

现在你已经了解了所有功能，开始使用吧！

```bash
npm run dev
```

访问 http://localhost:3000，上传 PDF，选择调用方式，查看效果！

如有问题，请查看文档或提交 Issue。

**祝使用愉快！** 🚀

