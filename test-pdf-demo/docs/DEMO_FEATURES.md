# Demo 功能演示

## 界面布局

### 左侧控制面板

```
┌─────────────────────────────────┐
│  PDF 解析 Demo                   │
│  基于 TextIn API 的文档位置溯源   │
├─────────────────────────────────┤
│  TextIn API Key                 │
│  [输入框: 密码类型]              │
│                                  │
│  上传 PDF 文件                   │
│  [文件选择按钮]                  │
│  已选择: document.pdf            │
│                                  │
│  [调用 API 解析]  ← 蓝色按钮     │
│  [使用模拟数据测试] ← 绿色按钮    │
│                                  │
│  ┌─────────────────────────┐    │
│  │ ✓ 解析结果              │    │
│  │ 总页数: 3               │    │
│  │ 总元素数: 15            │    │
│  │ 第 1 页: 5 个元素       │    │
│  │ 第 2 页: 7 个元素       │    │
│  │ 第 3 页: 3 个元素       │    │
│  └─────────────────────────┘    │
│                                  │
│  使用说明                        │
│  1. 输入 API Key               │
│  2. 上传 PDF 文件              │
│  3. 点击解析                   │
│  ...                           │
└─────────────────────────────────┘
```

### 右侧 PDF 预览区

```
┌──────────────────────────────────────────┐
│  ◄ 上一页   1 / 3   下一页 ►    - 150% + │
├──────────────────────────────────────────┤
│                                          │
│     ┌────────────────────────────┐      │
│     │  ┏━━━━━━━━━━━━┓            │      │
│     │  ┃ ①        ┃  ← 标题框    │      │
│     │  ┗━━━━━━━━━━━━┛            │      │
│     │                            │      │
│     │  ┏━━━━━━━━━━━━━━━━━━┓      │      │
│     │  ┃ ②              ┃      │      │
│     │  ┃                ┃  ← 段落  │      │
│     │  ┃                ┃      │      │
│     │  ┗━━━━━━━━━━━━━━━━━━┛      │      │
│     │                            │      │
│     │  ┏━━━━━━━━━━━━━━┓          │      │
│     │  ┃ ③          ┃  ← 表格   │      │
│     │  ┃ ┌──┬──┬──┐ ┃          │      │
│     │  ┃ ├──┼──┼──┤ ┃          │      │
│     │  ┃ └──┴──┴──┘ ┃          │      │
│     │  ┗━━━━━━━━━━━━━━┛          │      │
│     │                            │      │
│     └────────────────────────────┘      │
│                                          │
├──────────────────────────────────────────┤
│  🟥 文本  🟩 表格  🟦 图片  🟧 标题  🟪 段落 │
└──────────────────────────────────────────┘
```

## 核心功能

### 1. PDF 上传

- ✅ 支持拖拽上传（可扩展）
- ✅ 支持点击选择文件
- ✅ 文件类型验证（仅 PDF）
- ✅ 显示已选文件名称

### 2. API 集成

#### 真实 API 模式

```typescript
// 用户提供 API Key
// 上传文件到 TextIn API
// 等待解析结果
// 显示标识框
```

#### 模拟数据模式

```typescript
// 无需 API Key
// 使用预定义的测试数据
// 立即显示结果
// 用于快速测试 UI
```

### 3. PDF 渲染

**技术实现：**

- 使用 `react-pdf` 库
- 基于 `pdfjs-dist` 核心
- Canvas 渲染模式
- 支持文本图层

**功能：**

- ✅ 逐页渲染
- ✅ 缩放控制 (50% - 300%)
- ✅ 翻页控制
- ✅ 页码显示
- ✅ 响应式布局

### 4. 标识框绘制

**绘制方式：**

使用 SVG `<polygon>` 元素覆盖在 PDF 页面上

```typescript
// 8个坐标值表示4个点
position: [x1, y1, x2, y2, x3, y3, x4, y4]

// 转换为 SVG points
points = "x1,y1 x2,y2 x3,y3 x4,y4"
```

**视觉效果：**

- 半透明填充
- 彩色边框
- 悬停高亮
- 序号标签

**元素类型：**

| 类型      | 颜色   | 用途       |
| --------- | ------ | ---------- |
| text      | 红色   | 普通文本   |
| table     | 绿色   | 表格区域   |
| image     | 蓝色   | 图片区域   |
| title     | 橙色   | 标题       |
| paragraph | 紫色   | 段落       |

### 5. 交互功能

#### 缩放控制

```typescript
- 点击 "+" 放大 (scale += 0.25)
- 点击 "-" 缩小 (scale -= 0.25)
- 范围: 50% - 300%
```

#### 翻页控制

```typescript
- 上一页: pageNumber -= 1
- 下一页: pageNumber += 1
- 显示当前页码
- 禁用边界按钮
```

#### 标识框交互（可扩展）

```typescript
- 悬停高亮
- 点击选中
- 显示详细信息
- 跳转到对应内容
```

## 数据流程

```
┌──────────┐
│ 用户上传  │
│ PDF 文件 │
└─────┬────┘
      │
      ▼
┌──────────────┐
│ 调用 API 或  │
│ 使用模拟数据 │
└──────┬───────┘
       │
       ▼
┌───────────────┐
│ 解析 JSON     │
│ result.pages  │
└───────┬───────┘
        │
        ▼
┌─────────────────┐
│ 提取 rects 数组 │
│ 按页组织        │
└────────┬────────┘
         │
         ▼
┌──────────────────┐
│ 渲染 PDF + SVG   │
│ 显示标识框       │
└──────────────────┘
```

## 示例数据格式

### 输入：TextIn API 响应

```json
{
  "code": 200,
  "result": {
    "pages": [
      {
        "width": 595,
        "height": 842,
        "angle": 0,
        "rects": [
          {
            "position": [50, 50, 300, 50, 300, 100, 50, 100],
            "type": "title",
            "content_id": 1
          },
          {
            "position": [50, 120, 500, 120, 500, 200, 50, 200],
            "type": "paragraph",
            "content_id": 2
          }
        ]
      }
    ]
  }
}
```

### 处理后：Rects 数组

```typescript
[
  // 第一页
  [
    {
      position: [50, 50, 300, 50, 300, 100, 50, 100],
      type: "title",
      content_id: 1,
    },
    {
      position: [50, 120, 500, 120, 500, 200, 50, 200],
      type: "paragraph",
      content_id: 2,
    },
  ],
  // 第二页
  [...],
];
```

## 坐标系统说明

### PDF 坐标系

```
(0,0) ────────────► X
  │
  │    PDF 页面
  │
  ▼
  Y
```

- 原点在左上角
- X 轴向右
- Y 轴向下
- 单位：点（point）, 1 inch = 72 points

### 标识框坐标

```
(x1,y1) ────────► (x2,y2)
   │                 │
   │    标识框       │
   │                 │
   ▼                 ▼
(x4,y4) ◄──────── (x3,y3)
```

### 缩放处理

```typescript
// 原始坐标
const originalPosition = [50, 100, 200, 100, 200, 150, 50, 150];

// 应用缩放
const scale = 1.5; // 150%
const scaledPosition = originalPosition.map((val) => val * scale);
// [75, 150, 300, 150, 300, 225, 75, 225]
```

## 扩展功能建议

### 1. 高级交互

- [ ] 点击标识框显示详情面板
- [ ] 标识框与文本内容联动
- [ ] 支持筛选显示特定类型
- [ ] 支持搜索定位

### 2. 导出功能

- [ ] 导出标注后的 PDF
- [ ] 导出解析结果 JSON
- [ ] 生成分析报告

### 3. 批量处理

- [ ] 支持多文件上传
- [ ] 批量解析队列
- [ ] 进度显示

### 4. 结果编辑

- [ ] 手动调整标识框
- [ ] 添加/删除标识框
- [ ] 修改元素类型
- [ ] 保存修改后的结果

### 5. 对比功能

- [ ] 显示原文与识别结果对比
- [ ] 准确率统计
- [ ] 错误标注

## 性能优化

### 当前实现

- ✅ 按需加载页面（react-pdf 自动优化）
- ✅ SVG 渲染（高性能）
- ✅ 防抖处理（缩放调整）

### 可优化项

- [ ] 虚拟滚动（处理大量标识框）
- [ ] 懒加载图片（如果有缩略图）
- [ ] Web Worker（处理大型 JSON）
- [ ] IndexedDB 缓存（缓存解析结果）

## 浏览器兼容性

| 浏览器  | 版本      | 支持度 |
| ------- | --------- | ------ |
| Chrome  | 90+       | ✅ 完全 |
| Firefox | 88+       | ✅ 完全 |
| Safari  | 14+       | ✅ 完全 |
| Edge    | 90+       | ✅ 完全 |
| IE      | 不支持    | ❌      |

## 移动端适配

当前 Demo 主要面向桌面端，如需移动端支持：

- [ ] 响应式布局调整
- [ ] 触摸手势支持（缩放、翻页）
- [ ] 移动端优化的控制按钮
- [ ] 性能优化（减少渲染开销）

